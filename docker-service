#!/bin/bash
# --------------------------------------------------
# Script for admin docker engine service
# Create /usr/local/bin/docker-service (chmod +x) 
# --------------------------------------------------

# Function to show Docker status and approximate RAM usage
docker_info() {
    echo "Docker service status:"
    systemctl is-active docker
    if pgrep -x dockerd >/dev/null; then
        ram=$(ps -o rss= -p $(pgrep -x dockerd) | awk '{printf "%.2f MB\n", $1/1024}')
        echo "Docker is using approximately: $ram RAM"
    else
        echo "Docker is not running."
    fi
}

# Function to show help
show_help() {
    echo "Description: Script for admin docker engine service."
    echo "Usage: docker-service {start|stop|enable|disable|status|help}"
    echo "  start   - Start Docker immediately"
    echo "  stop    - Stop Docker immediately"
    echo "  enable  - Enable Docker to start at system boot"
    echo "  disable - Disable Docker from starting at system boot"
    echo "  status  - Show Docker status and RAM usage"
    echo "  help    - Show this help message"
}

# If no argument is provided, show help
if [ -z "$1" ]; then
    show_help
    exit 0
fi

case "$1" in
    start)
        echo "Starting Docker..."
        sudo systemctl start docker
        docker_info
        ;;
    stop)
        echo "Stopping Docker..."
        sudo systemctl stop docker
        sudo systemctl stop containerd
        docker_info
        ;;
    enable)
        echo "Enabling Docker at system boot..."
        sudo systemctl enable docker
        sudo systemctl enable containerd
        docker_info
        ;;
    disable)
        echo "Disabling Docker at system boot..."
        sudo systemctl disable docker
        sudo systemctl disable containerd
        docker_info
        ;;
    status)
        docker_info
        ;;
    help)
        show_help
        ;;
    *)
        echo "Unknown command: $1"
        show_help
        ;;
esac
